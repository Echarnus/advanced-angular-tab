name: Deploy to GitHub Pages

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
      
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Setup Pages
        uses: actions/configure-pages@v4

      - name: Install React dependencies
        run: npm ci

      - name: Build React demo
        run: npm run build

      - name: Install Angular dependencies
        run: |
          cd angular
          npm ci

      - name: Build Angular demo
        run: |
          cd angular
          npm run build

      - name: Create combined deployment structure
        run: |
          mkdir -p dist-combined
          
          # Copy React build
          cp -r dist/* dist-combined/
          
          # Copy Angular build to subdirectory
          mkdir -p dist-combined/angular
          cp -r angular/dist/angular/browser/* dist-combined/angular/
          
          # Create main index.html that links to both demos
          cat > dist-combined/index.html << 'EOF'
          <!DOCTYPE html>
          <html lang="en">
          <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <title>Advanced Data Table Demos</title>
              <script src="https://cdn.tailwindcss.com"></script>
              <style>
                  .demo-card {
                      transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
                  }
                  .demo-card:hover {
                      transform: translateY(-4px);
                      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
                  }
              </style>
          </head>
          <body class="bg-gray-50 min-h-screen">
              <div class="container mx-auto px-6 py-12">
                  <div class="text-center mb-12">
                      <h1 class="text-4xl font-bold text-gray-900 mb-4">Advanced Data Table</h1>
                      <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                          A comprehensive table component with sticky headers, sorting, pagination, expandable rows, 
                          frozen columns, and flexible width handling. Available in both React and Angular implementations.
                      </p>
                  </div>
                  
                  <div class="grid md:grid-cols-2 gap-8 max-w-4xl mx-auto">
                      <!-- React Demo Card -->
                      <div class="demo-card bg-white rounded-lg shadow-lg overflow-hidden">
                          <div class="p-6">
                              <div class="flex items-center mb-4">
                                  <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-4">
                                      <svg class="w-6 h-6 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
                                          <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1H5C3.89 1 3 1.89 3 3V21C3 22.11 3.89 23 5 23H11.81C11.42 22.34 11.17 21.6 11.07 20.81C10.5 20.93 9.91 21 9.31 21H5V3H14V8H19V9.5C19.78 9.5 20.5 9.71 21 10.08V9Z"/>
                                      </svg>
                                  </div>
                                  <div>
                                      <h2 class="text-2xl font-bold text-gray-900">React Demo</h2>
                                      <p class="text-gray-600">Built with React 19 + Vite</p>
                                  </div>
                              </div>
                              <p class="text-gray-700 mb-6">
                                  Explore the React implementation featuring modern hooks, TypeScript support, 
                                  and shadcn/ui components with Tailwind CSS styling.
                              </p>
                              <div class="flex flex-wrap gap-2 mb-6">
                                  <span class="px-3 py-1 bg-blue-100 text-blue-800 text-sm font-medium rounded-full">React 19</span>
                                  <span class="px-3 py-1 bg-green-100 text-green-800 text-sm font-medium rounded-full">TypeScript</span>
                                  <span class="px-3 py-1 bg-purple-100 text-purple-800 text-sm font-medium rounded-full">Vite</span>
                                  <span class="px-3 py-1 bg-cyan-100 text-cyan-800 text-sm font-medium rounded-full">Tailwind CSS</span>
                              </div>
                              <a href="./react-demo.html" class="inline-flex items-center px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors">
                                  View React Demo
                                  <svg class="ml-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                                  </svg>
                              </a>
                          </div>
                      </div>
                      
                      <!-- Angular Demo Card -->
                      <div class="demo-card bg-white rounded-lg shadow-lg overflow-hidden">
                          <div class="p-6">
                              <div class="flex items-center mb-4">
                                  <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center mr-4">
                                      <svg class="w-6 h-6 text-red-600" fill="currentColor" viewBox="0 0 24 24">
                                          <path d="M9.93 12.645L12 15.22l2.07-2.575L12 9.065l-2.07 3.58zm-1.464-.37L12 3.475l3.534 8.8L12 20.525L8.466 12.275z"/>
                                      </svg>
                                  </div>
                                  <div>
                                      <h2 class="text-2xl font-bold text-gray-900">Angular Demo</h2>
                                      <p class="text-gray-600">Built with Angular 19</p>
                                  </div>
                              </div>
                              <p class="text-gray-700 mb-6">
                                  Experience the Angular implementation with standalone components, 
                                  reactive patterns, and modern Angular architecture.
                              </p>
                              <div class="flex flex-wrap gap-2 mb-6">
                                  <span class="px-3 py-1 bg-red-100 text-red-800 text-sm font-medium rounded-full">Angular 19</span>
                                  <span class="px-3 py-1 bg-green-100 text-green-800 text-sm font-medium rounded-full">TypeScript</span>
                                  <span class="px-3 py-1 bg-orange-100 text-orange-800 text-sm font-medium rounded-full">Standalone</span>
                                  <span class="px-3 py-1 bg-cyan-100 text-cyan-800 text-sm font-medium rounded-full">Tailwind CSS</span>
                              </div>
                              <a href="./angular/" class="inline-flex items-center px-6 py-3 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 transition-colors">
                                  View Angular Demo
                                  <svg class="ml-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                                  </svg>
                              </a>
                          </div>
                      </div>
                  </div>
                  
                  <!-- Features Section -->
                  <div class="mt-16">
                      <h2 class="text-3xl font-bold text-center text-gray-900 mb-8">Key Features</h2>
                      <div class="grid md:grid-cols-3 gap-6 max-w-5xl mx-auto">
                          <div class="text-center">
                              <div class="w-16 h-16 bg-indigo-100 rounded-lg flex items-center justify-center mx-auto mb-4">
                                  <svg class="w-8 h-8 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"/>
                                  </svg>
                              </div>
                              <h3 class="text-xl font-semibold text-gray-900 mb-2">Sticky Headers</h3>
                              <p class="text-gray-600">Headers remain visible during scroll with dynamic positioning</p>
                          </div>
                          <div class="text-center">
                              <div class="w-16 h-16 bg-green-100 rounded-lg flex items-center justify-center mx-auto mb-4">
                                  <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/>
                                  </svg>
                              </div>
                              <h3 class="text-xl font-semibold text-gray-900 mb-2">Advanced Sorting</h3>
                              <p class="text-gray-600">Click column headers to cycle through ascending/descending/none</p>
                          </div>
                          <div class="text-center">
                              <div class="w-16 h-16 bg-purple-100 rounded-lg flex items-center justify-center mx-auto mb-4">
                                  <svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"/>
                                  </svg>
                              </div>
                              <h3 class="text-xl font-semibold text-gray-900 mb-2">Expandable Rows</h3>
                              <p class="text-gray-600">Click expand buttons to reveal detailed information</p>
                          </div>
                          <div class="text-center">
                              <div class="w-16 h-16 bg-yellow-100 rounded-lg flex items-center justify-center mx-auto mb-4">
                                  <svg class="w-8 h-8 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                  </svg>
                              </div>
                              <h3 class="text-xl font-semibold text-gray-900 mb-2">Pagination</h3>
                              <p class="text-gray-600">Navigate through pages with configurable sizes</p>
                          </div>
                          <div class="text-center">
                              <div class="w-16 h-16 bg-blue-100 rounded-lg flex items-center justify-center mx-auto mb-4">
                                  <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"/>
                                  </svg>
                              </div>
                              <h3 class="text-xl font-semibold text-gray-900 mb-2">Frozen Columns</h3>
                              <p class="text-gray-600">ID and Last Login columns remain fixed during horizontal scroll</p>
                          </div>
                          <div class="text-center">
                              <div class="w-16 h-16 bg-pink-100 rounded-lg flex items-center justify-center mx-auto mb-4">
                                  <svg class="w-8 h-8 text-pink-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a2 2 0 002-2V5z"/>
                                  </svg>
                              </div>
                              <h3 class="text-xl font-semibold text-gray-900 mb-2">Custom Rendering</h3>
                              <p class="text-gray-600">Role and status badges with appropriate color coding</p>
                          </div>
                      </div>
                  </div>
                  
                  <!-- Footer -->
                  <div class="mt-16 text-center">
                      <p class="text-gray-600 mb-4">
                          Built with ❤️ using modern web technologies
                      </p>
                      <a href="https://github.com/Echarnus/advanced-angular-tab" class="inline-flex items-center text-blue-600 hover:text-blue-800 font-medium">
                          <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
                              <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                          </svg>
                          View on GitHub
                      </a>
                  </div>
              </div>
          </body>
          </html>
          EOF
          
          # Create a copy of the original React index for the react-demo link
          cp dist/index.html dist-combined/react-demo.html

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: './dist-combined'

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4